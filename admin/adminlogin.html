<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Official Admin Login | BDBS</title>
    <!-- Uses the common login.css for consistent look and feel -->
    <link rel="stylesheet" href="adminlogin.css"> 
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

    <div class="split-container">
        <!-- LEFT SIDE: WELCOME SECTION (Admin Content) -->
        <div class="welcome-section">
            <div class="welcome-content">
                <!-- Logo remains centered and large, using the same class -->
                <img src="logo 1.png" alt="BDBS Logo" class="welcome-logo">
                
                <!-- Admin-specific Welcome Text -->
                <h1>Official Access</h1>
                <p>This portal is exclusively for Barangay Officials and Administrators to manage reports and oversee system operations.</p>
            </div>
        </div>

        <!-- RIGHT SIDE: LOGIN FORM -->
        <div class="login-section">
            <div class="login-card">
                <h2>Official Sign In</h2>
                
                <form id="loginForm">
                    
                    <!-- Input field for Email/Identifier -->
                    <div class="form-group icon-input">
                        <i class="fas fa-user-shield"></i> <!-- Admin Icon -->
                        <input type="email" id="email" placeholder="Official Email" required>
                    </div>

                    <!-- Input field for Password -->
                    <div class="form-group password-wrapper icon-input">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="password" placeholder="Password" required>
                        <span class="password-toggle-icon" onclick="togglePasswordVisibility('password')">
                            <i class="far fa-eye"></i>
                        </span>
                    </div>

                    <button type="submit" class="sign-in-btn">Log In</button>
                </form>

              
            </div>
        </div>
    </div>

<script>
Â  Â  // ğŸ”‘ Toggle password visibility function
Â  Â  function togglePasswordVisibility(id) {
Â  Â  Â  Â  const input = document.getElementById(id);
Â  Â  Â  Â  const icon = input.parentElement.querySelector('.password-toggle-icon i');

Â  Â  Â  Â  if (input.type === "password") {
Â  Â  Â  Â  Â  Â  input.type = "text";
Â  Â  Â  Â  Â  Â  icon.classList.remove('fa-eye');
Â  Â  Â  Â  Â  Â  icon.classList.add('fa-eye-slash');
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  input.type = "password";
Â  Â  Â  Â  Â  Â  icon.classList.remove('fa-eye-slash');
Â  Â  Â  Â  Â  Â  icon.classList.add('fa-eye');
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // Submit form and send data to admin backend endpoint
Â  Â  document.getElementById("loginForm").addEventListener("submit", async function(event) {
Â  Â  Â  Â  event.preventDefault();

Â  Â  Â  Â  const email = document.getElementById("email").value.trim(); 
Â  Â  Â  Â  const password = document.getElementById("password").value;

Â  Â  Â  Â  if (!email || !password) {
Â  Â  Â  Â  Â  Â  alert("âš ï¸ Please enter both email and password.");
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

        // REMOVED: Frontend email check is not secure. Trust server for validation.
        /* Â  Â  Â  Â  const REQUIRED_ADMIN_EMAIL = "admintest@gmail.com";
Â  Â  Â  Â  if (email !== REQUIRED_ADMIN_EMAIL) {
Â  Â  Â  Â  Â  Â  alert("ğŸš« Access denied. This email is not authorized for the Official/Admin Login.");
Â  Â  Â  Â  Â  Â  document.getElementById("email").value = ""; 
Â  Â  Â  Â  Â  Â  document.getElementById("password").value = "";
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
        */

Â  Â  Â  Â  const adminCredentials = {
Â  Â  Â  Â  Â  Â  email: email, 
Â  Â  Â  Â  Â  Â  password: password,
Â  Â  Â  Â  Â  Â  // Removed: 'role' field is not needed if the server checks user_type
Â  Â  Â  Â  };
Â  Â  Â  Â  
Â  Â  Â  Â  // IMPORTANT: Targeting the ADMIN specific login endpoint
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const response = await fetch("http://localhost:8081/admin/login", {
Â  Â  Â  Â  Â  Â  Â  Â  method: "POST",
Â  Â  Â  Â  Â  Â  Â  Â  headers: { "Content-Type": "application/json" },
Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify(adminCredentials),
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  const result = await response.json();
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  if (response.ok && result.user) {
                const userType = result.user.user_type?.toLowerCase();

                if (userType === 'official') {
                    alert("âœ… Admin Login successful!");
                    
                    // 1. CLEAR RESIDENT KEY: Remove the resident key
                    localStorage.removeItem("residentUser");
                    // 2. USE UNIQUE ADMIN KEY: Save data under 'adminUser'
                    localStorage.setItem("adminUser", JSON.stringify(result.user));
                    // 3. CLEAR OLD KEY: Ensure no generic 'user' key is left
                    localStorage.removeItem("user"); 

                    window.location.href = "../admin/dashboard.html"; 
                } else {
                    // This handles if a Resident somehow used the Admin login page
                    alert("Access denied: You are not authorized for the Admin portal.");
                    localStorage.removeItem("adminUser");
                    localStorage.removeItem("user");
                }
Â  Â  Â  Â  Â  Â  } else {
                // Failure case: Invalid creds or non-official user rejected by server
Â  Â  Â  Â  Â  Â  Â  Â  alert(result.message || "âŒ Invalid email or password or unauthorized access.");
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.removeItem("adminUser");
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.removeItem("user");
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  console.error("Login error:", error);
Â  Â  Â  Â  Â  Â  alert("âŒ Failed to connect to the server.");
Â  Â  Â  Â  }
Â  Â  });
</script>

</body>
</html>
